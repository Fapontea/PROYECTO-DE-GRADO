<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero de Estad√≠sticas (Cascar√≥n)</title>
    <link rel="stylesheet" href="css/grafico.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="metric-card">
                <div class="metric-value">34533</div>
                <div class="metric-label">Ventas</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">3 Sec</div>
                <div class="metric-label">Tiempo de cargue</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">110</div>
                <div class="metric-label">Duplicados</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">1%</div>
                <div class="metric-label">Porcentaje de error</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">Admin</div>
                <div class="metric-label">Usuario</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">Fredy SAS</div>
                <div class="metric-label">Compania</div>
            </div>
        </div>

        <div class="main-content">
            <div class="top-section">
                <div class="chart-container">
                    <h2>Visits by Week of Year</h2>
                    <div class="placeholder-chart"></div>
                </div>
                <div class="chart-container">
                    <h2>Bounce Rate by Week of Year</h2>
                    <div class="placeholder-chart"></div>
                </div>
            </div>

            <div class="middle-section">
                <div class="chart-container">
                    <h2>Traffic Sources</h2>
                    <div class="placeholder-chart pie"></div>
                    <ul class="chart-legend">
                        <li><span class="legend-color direct"></span> Direct</li>
                        <li><span class="legend-color display"></span> Display</li>
                        <li><span class="legend-color organic"></span> Organic</li>
                        <li><span class="legend-color paid"></span> Paid</li>
                        <li><span class="legend-color referral"></span> Referral</li>
                        <li><span class="legend-color social"></span> Social</li>
                    </ul>
                </div>
                <div class="chart-container">
                    <h2>Visitors by User Type</h2>
                    <div class="placeholder-chart bar"></div>
                    <ul class="chart-legend">
                        <li><span class="legend-color new"></span> New</li>
                        <li><span class="legend-color returning"></span> Returning</li>
                    </ul>
                </div>
            </div>

            <div class="bottom-section">
                <div class="table-container">
                    <h2>Top 3 mejores opciones</h2>
                    <div class="placeholder-table">
                        <div class="table-row"><span>Organic</span> <span class="bar-indicator" style="width: 15%;"></span> 15%</div>
                        <div class="table-row"><span>Paid Search</span> <span class="bar-indicator" style="width: 12%;"></span> 12%</div>
                        <div class="table-row"><span>Direct</span> <span class="bar-indicator" style="width: 11%;"></span> 11%</div>
                    </div>
                </div>
                <div class="table-container">
                    <h2>Top 3 mejores asesores</h2>
                    <div class="placeholder-table">
                        <div class="table-row"><span>Campaign 3</span> <span class="bar-indicator" style="width: 18%;"></span> 18%</div>
                        <div class="table-row"><span>Campaign 2</span> <span class="bar-indicator" style="width: 11%;"></span> 11%</div>
                        <div class="table-row"><span>Campaign 1</span> <span class="bar-indicator" style="width: 10%;"></span> 10%</div>
                    </div>
                </div>
                <div class="table-container">
                    <h2>Top 3 productos actuales</h2>
                    <div class="placeholder-table">
                        <div class="table-row"><span>Page 3</span> <span class="bar-indicator" style="width: 29%;"></span> 29%</div>
                        <div class="table-row"><span>Page 2</span> <span class="bar-indicator" style="width: 13%;"></span> 13%</div>
                        <div class="table-row"><span>Page 1</span> <span class="bar-indicator" style="width: 12%;"></span> 12%</div>
                    </div>
                </div>
                </div>
               
               
                <title>Leer PDF, Graficar, Nube de Palabras y Descargar Reporte</title>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.0.6/wordcloud2.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
                <style>
                  body { font-family: Arial, sans-serif; margin: 20px; }
                  .input-group { margin-bottom: 10px; }
                  #nubePalabras { width: 600px; height: 400px; border: 1px solid #ccc; margin-top: 20px; }
                  #graficaResultados { margin-top: 20px; }
                  #botonDescargar { margin-top: 20px; }
                </style>


              
              <h2>Subir nuevamente el archivo PDF y Analizar la cantidad de la palabra clave</h2>

              <div class="input-group">
                <label>Seleccionar PDF:</label><br>
                <input type="file" id="archivoPDF" accept="application/pdf">
              </div>
            
              <div class="input-group">
                <label>Palabra a Buscar:</label><br>
                <input type="text" id="palabraBuscar" placeholder="Escribe una palabra...">
              </div>
            
              <button id="botonProcesar">Procesar PDF</button>
            
              <h3>Gr√°fica de Resultados</h3>
              <canvas id="graficaResultados" width="600" height="400"></canvas>
            
              <h3>Nube de Palabras üå•Ô∏è</h3>
              <div id="nubePalabras"></div>
            
              <button id="botonDescargar">üì• Descargar Reporte PDF</button>

              <script>
               
    const archivoPDFInput = document.getElementById('archivoPDF');
    const palabraBuscarInput = document.getElementById('palabraBuscar');
    const botonProcesar = document.getElementById('botonProcesar');
    const botonDescargar = document.getElementById('botonDescargar');
    const ctxGrafica = document.getElementById('graficaResultados').getContext('2d');
    const nubePalabrasDiv = document.getElementById('nubePalabras');

    let grafico;
    let archivoPDFSeleccionado;
    let nombreArchivo = '';

    let resumenDatos = {
      numPages: 0,
      totalWords: 0,
      palabraBuscada: '',
      palabraRepetida: 0
    };

    archivoPDFInput.addEventListener('change', (e) => {
      archivoPDFSeleccionado = e.target.files[0];
      nombreArchivo = archivoPDFSeleccionado.name;
    });

    botonProcesar.addEventListener('click', async () => {
      if (!archivoPDFSeleccionado) {
        alert('Primero selecciona un archivo PDF.');
        return;
      }

      resumenDatos.palabraBuscada = palabraBuscarInput.value.trim().toLowerCase();
      const fileReader = new FileReader();

      fileReader.onload = async function() {
        const typedarray = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument({ data: typedarray }).promise;
        resumenDatos.numPages = pdf.numPages;
        resumenDatos.totalWords = 0;
        resumenDatos.palabraRepetida = 0;
        const frecuenciaPalabras = {};

        for (let i = 1; i <= resumenDatos.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');

          const palabras = pageText
            .toLowerCase()
            .replace(/[^\w\s√°√©√≠√≥√∫√º√±]/gi, '')
            .split(/\s+/)
            .filter(word => word.length > 2);

          resumenDatos.totalWords += palabras.length;

          palabras.forEach(word => {
            frecuenciaPalabras[word] = (frecuenciaPalabras[word] || 0) + 1;
          });

          if (resumenDatos.palabraBuscada) {
            resumenDatos.palabraRepetida += palabras.filter(word => word === resumenDatos.palabraBuscada).length;
          }
        }

        if (grafico) grafico.destroy();

        grafico = new Chart(ctxGrafica, {
          type: 'bar',
          data: {
            labels: ['P√°ginas', 'Palabras', `Veces "${resumenDatos.palabraBuscada}"`],
            datasets: [{
              label: 'Conteo',
              data: [resumenDatos.numPages, resumenDatos.totalWords, resumenDatos.palabraRepetida],
              backgroundColor: [
                'rgba(75, 192, 192, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(255, 99, 132, 0.6)'
              ],
              borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255, 99, 132, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });

        const palabrasFrecuentes = Object.entries(frecuenciaPalabras)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 100);

        WordCloud(nubePalabrasDiv, {
          list: palabrasFrecuentes,
          gridSize: 10,
          weightFactor: 5,
          fontFamily: 'Times, serif',
          color: 'random-dark',
          backgroundColor: '#f5f5f5'
        });
      };

      fileReader.readAsArrayBuffer(archivoPDFSeleccionado);
    });

    botonDescargar.addEventListener('click', async () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');

      const canvasGrafica = document.getElementById('graficaResultados');
      const graficaImg = canvasGrafica.toDataURL('image/png');

      const fecha = new Date();
      const fechaTexto = fecha.toLocaleDateString('es-ES') + ' ' + fecha.toLocaleTimeString('es-ES');

      // --- P√°gina 1: Portada ---
      pdf.setFontSize(22);
      pdf.text('üìÑ An√°lisis de Documento PDF', 40, 80);

      pdf.setFontSize(16);
      pdf.text(`Archivo Analizado:`, 40, 100);
      pdf.setFontSize(12);
      pdf.text(nombreArchivo, 40, 110);

      pdf.setFontSize(16);
      pdf.text(`Fecha de An√°lisis:`, 40, 130);
      pdf.setFontSize(12);
      pdf.text(fechaTexto, 40, 140);

      pdf.addPage();

      // --- P√°gina 2: Resumen y Gr√°fica ---
      await html2canvas(nubePalabrasDiv).then(canvas => {
        const nubeImg = canvas.toDataURL('image/png');

        pdf.setFontSize(18);
        pdf.text('üìã Resumen de An√°lisis', 10, 20);

        pdf.setFontSize(12);
        pdf.text(`- N√∫mero de P√°ginas: ${resumenDatos.numPages}`, 10, 30);
        pdf.text(`- Palabras Totales: ${resumenDatos.totalWords}`, 10, 37);

        if (resumenDatos.palabraBuscada) {
          pdf.text(`- Veces que aparece "${resumenDatos.palabraBuscada}": ${resumenDatos.palabraRepetida}`, 10, 44);
        }

        pdf.text('Gr√°fica de Resultados:', 10, 55);
        pdf.addImage(graficaImg, 'PNG', 10, 60, 190, 80);

        pdf.text('Nube de Palabras:', 10, 150);
        pdf.addImage(nubeImg, 'PNG', 10, 155, 190, 80);

        pdf.save('reporte_analisis.pdf');
      });
    });
  </script>
            </div>
        </div>
    </div>
</body>
</html>


